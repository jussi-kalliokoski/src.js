var Sink=this.Sink=function(a){function b(a,c,d,e){var f=b.sinks.list,g;for(g=0;g<f.length;g++)if(f[g].enabled)try{return new f[g](a,c,d,e)}catch(h){}throw b.Error(2)}function c(){}function d(a,c,e,f,g){e=e||c.prototype,c.prototype=new b.SinkClass,c.prototype.type=a,c.enabled=!f;for(f in e)e.hasOwnProperty(f)&&(c.prototype[f]=e[f]);d[a]=c,d.list[g?"unshift":"push"](c)}return b.SinkClass=c,c.prototype=b.prototype={sampleRate:44100,channelCount:2,bufferSize:4096,writePosition:0,previousHit:0,ringOffset:0,channelMode:"interleaved",isReady:!1,start:function(a,c,d,e){this.channelCount=isNaN(c)||c===null?this.channelCount:c,this.bufferSize=isNaN(d)||d===null?this.bufferSize:d,this.sampleRate=isNaN(e)||e===null?this.sampleRate:e,this.readFn=a,this.activeRecordings=[],this.previousHit=+(new Date),b.EventEmitter.call(this),b.emit("init",[this].concat([].slice.call(arguments)))},process:function(a,c){this.emit("preprocess",arguments),this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments);if(this.channelMode==="interleaved")this.emit("audioprocess",arguments),this.readFn&&this.readFn.apply(this,arguments);else{var d=b.deinterleave(a,this.channelCount),e=[d].concat([].slice.call(arguments,1));this.emit("audioprocess",e),this.readFn&&this.readFn.apply(this,e),b.interleave(d,this.channelCount,a)}this.emit("postprocess",arguments),this.previousHit=+(new Date),this.writePosition+=a.length/c},getPlaybackTime:function(){return this.writePosition-this.bufferSize},ready:function(){if(this.isReady)return;this.isReady=!0,this.emit("ready",[])}},b.sinks=b.devices=d,b.sinks.list=[],b.singleton=function(){var a=b.apply(null,arguments);return b.singleton=function(){return a},a},a.Sink=b,b}(function(){return this}());(function(a){function b(){var a;for(a in b.prototype)b.prototype.hasOwnProperty(a)&&(this[a]=b.prototype[a]);this._listeners={}}b.prototype={_listeners:null,emit:function(a,b){if(this._listeners[a])for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c].apply(this,b);return this},on:function(a,b){return this._listeners[a]=this._listeners[a]||[],this._listeners[a].push(b),this},off:function(a,b){if(this._listeners[a]){if(!b)return delete this._listeners[a],this;for(var c=0;c<this._listeners[a].length;c++)this._listeners[a][c]===b&&this._listeners[a].splice(c--,1);this._listeners[a].length||delete this._listeners[a]}return this}},a.EventEmitter=b,b.call(a)})(this.Sink),function(a){function b(a){if(!b.hasOwnProperty(a))throw b(1);if(!(this instanceof b))return new b(a);var c;for(c in b[a])b[a].hasOwnProperty(c)&&(this[c]=b[a][c]);this.code=a}b.prototype=new Error,b.prototype.toString=function(){return"SinkError 0x"+this.code.toString(16)+": "+this.message},b[1]={message:"No such error code.",explanation:"The error code does not exist."},b[2]={message:"No audio sink available.",explanation:"The audio device may be busy, or no supported output API is available for this browser."},b[16]={message:"Buffer underflow.",explanation:"Trying to recover..."},b[17]={message:"Critical recovery fail.",explanation:"The buffer underflow has reached a critical point, trying to recover, but will probably fail anyway."},b[18]={message:"Buffer size too large.",explanation:"Unable to allocate the buffer due to excessive length, please try a smaller buffer. Buffer size should probably be smaller than the sample rate."},a.Error=b}(this.Sink),function(a){function d(a){var e=null,f,g;try{return g=new b,g.append(a),f=c.createObjectURL(g.getBlob()),e=new Worker(f),e._terminate=e.terminate,e._url=f,g=null,e.terminate=function(){this._terminate(),c.revokeObjectURL(this._url)},d.type="blob",e}catch(h){}try{return e=new Worker("data:text/javascript;base64,"+btoa(a)),d.type="data",e}catch(h){}return e}var b=typeof window=="undefined"?undefined:window.MozBlobBuilder||window.WebKitBlobBuilder||window.MSBlobBuilder||window.OBlobBuilder||window.BlobBuilder,c=typeof window=="undefined"?undefined:window.MozURL||window.webkitURL||window.MSURL||window.OURL||window.URL;d.ready=d.working=!1,a.EventEmitter.call(d),d.test=function(){function c(b){if(d.ready)return;d.ready=!0,d.working=b,d.emit("ready",[b]),d.off("ready"),b&&a&&a.terminate(),a=null}var a=d("this.onmessage=function (e){postMessage(e.data)}"),b="inlineWorker";d.ready=d.working=!1,a?(a.onmessage=function(a){c(a.data===b)},a.postMessage(b),setTimeout(function(){c(!1)},1e3)):c(!1)},a.inlineWorker=d,d.test()}(this.Sink),function(a){a.doInterval=function(b,c){function f(f){a.inlineWorker.working&&!f?(d=a.inlineWorker('setInterval(function (){ postMessage("tic"); }, '+c+");"),d.onmessage=function(){b()},e=function(){d.terminate()}):(d=setInterval(b,c),e=function(){clearInterval(d)})}var d,e;return a.inlineWorker.ready?f():a.inlineWorker.on("ready",function(){f()}),function(){e?e():a.inlineWorker.ready||a.inlineWorker.on("ready",function(){e&&e()})}}}(this.Sink),function(a){a.sinks("audiodata",function(){function l(){if(d){f=e.mozWriteAudio(d),c+=f;if(f<d.length)return d=d.subarray(f),d;d=null}g=e.mozCurrentSampleOffset(),h=Number(g+(j!==g?b.bufferSize:b.preBufferSize)*b.channelCount-c),g===j&&b.emit("error",[a.Error(16)]);if(h>0||j===g){b.ready();try{i=new Float32Array(j===g?b.preBufferSize*b.channelCount:b.forceBufferSize?h<b.bufferSize*2?b.bufferSize*2:h:h)}catch(k){b.emit("error",[a.Error(18)]),b.kill();return}b.process(i,b.channelCount),f=b._audio.mozWriteAudio(i),f<i.length&&(d=i.subarray(f)),c+=f}j=g}var b=this,c=0,d=null,e=new Audio,f,g,h,i,j,k;b.start.apply(b,arguments),b.preBufferSize=isNaN(arguments[4])||arguments[4]===null?this.preBufferSize:arguments[4],e.mozSetup(b.channelCount,b.sampleRate),this._timers=[],this._timers.push(a.doInterval(function(){+(new Date)-b.previousHit>2e3&&(b._audio=e=new Audio,e.mozSetup(b.channelCount,b.sampleRate),c=0,b.emit("error",[a.Error(17)]))},1e3)),this._timers.push(a.doInterval(l,b.interval)),b._bufferFill=l,b._audio=e},{bufferSize:24576,preBufferSize:24576,forceBufferSize:!1,interval:20,kill:function(){while(this._timers.length)this._timers.shift()();this.emit("kill")},getPlaybackTime:function(){return this._audio.mozCurrentSampleOffset()/this.channelCount}},!1,!0),a.sinks.moz=a.sinks.audiodata}(this.Sink),function(a,b){function c(a){var b=document.createElement("audio");return a&&(b.src=a),b}function d(){var a=this;a.currentFrame=c(),a.nextFrame=c(),a._onended=function(){a.samples+=a.bufferSize,a.nextClip()}}var b=a.sinks;b("wav",function(){function i(){if(d._audio.hasNextFrame)return;d.ready(),a.memcpy(h,0,g,0),d.process(g,d.channelCount),d._audio.setSource("data:audio/wav;base64,"+btoa(audioLib.PCMData.encode({data:g,sampleRate:d.sampleRate,channelCount:d.channelCount,bytesPerSample:d.quality}))),d._audio.currentFrame.src||d._audio.nextClip()}var d=this,e=new b.wav.wavAudio,f=typeof f=="undefined"?audioLib.PCMData:f;d.start.apply(d,arguments);var g=new Float32Array(d.bufferSize*d.channelCount),h=new Float32Array(d.bufferSize*d.channelCount);if(!c().canPlayType("audio/wav; codecs=1")||!btoa)throw 0;d.kill=a.doInterval(i,40),d._bufferFill=i,d._audio=e},{quality:1,bufferSize:22050,getPlaybackTime:function(){var a=this._audio;return(a.currentFrame?a.currentFrame.currentTime*this.sampleRate:0)+a.samples}}),d.prototype={samples:0,nextFrame:null,currentFrame:null,_onended:null,hasNextFrame:!1,nextClip:function(){var a=this.currentFrame;this.currentFrame=this.nextFrame,this.nextFrame=a,this.hasNextFrame=!1,this.currentFrame.play()},setSource:function(a){this.nextFrame.src=a,this.nextFrame.addEventListener("ended",this._onended,!0),this.hasNextFrame=!0}},b.wav.wavAudio=d}(this.Sink),function(a){a.sinks("dummy",function(){function c(){var a=new Float32Array(b.bufferSize*b.channelCount);b.process(a,b.channelCount)}var b=this;b.start.apply(b,arguments),b._kill=a.doInterval(c,b.bufferSize/b.sampleRate*1e3),b._callback=c},{kill:function(){this._kill(),this.emit("kill")}},!0)}(this.Sink),function(a,b){a("webaudio",function(c,d,e,f){function l(a){var b=a.outputBuffer,c=b.numberOfChannels,d,e,f=b.length,h=b.size,i=new Array(c),l;g.ready(),j=j&&j.length===f*c?j:new Float32Array(f*c),k=k&&k.length===j.length?k:new Float32Array(f*c),j.set(k);for(d=0;d<c;d++)i[d]=b.getChannelData(d);g.process(j,g.channelCount);for(d=0;d<f;d++)for(e=0;e<c;e++)i[e][d]=j[d*g.channelCount+e]}var g=this,h=a.webaudio.getContext(),i=h.createJavaScriptNode(e,0,d),j=null,k=null;g.start.apply(g,arguments),g.sampleRate=h.sampleRate,i.onaudioprocess=l,i.connect(h.destination),g._context=h,g._node=i,g._callback=l,b.push(i)},{kill:function(){this._node.disconnect(0);for(var a=0;a<b.length;a++)b[a]===this._node&&b.splice(a--,1);this._node=this._context=null,this.emit("kill")},getPlaybackTime:function(){return this._context.currentTime*this.sampleRate}},!1,!0),a.webkit=a.webaudio,a.webaudio.fix82795=b,a.webaudio.getContext=function(){var b=new(window.AudioContext||webkitAudioContext);return a.webaudio.getContext=function(){return b},b}}(this.Sink.sinks,[]),function(a){a.sinks("worker",function(){function f(b){a.isReady||a.initMSP(b),a.ready();var f=a.channelCount,g=b.audioLength,h,i;c=c&&c.length===g*f?c:new Float32Array(g*f),d=d&&d.length===c.length?d:new Float32Array(g*f),e=e&&e.length===c.length?e:new Float32Array(g*f),c.set(e),d.set(e),a.process(c,a.channelCount);for(h=0;h<f;h++)for(i=0;i<g;i++)d[h*b.audioLength+i]=c[h+i*f];b.writeAudio(d)}function g(b){a.isReady||a.initWA(b),a.ready();var d=b.outputBuffer,f=d.numberOfChannels,g,h,i=d.length,j=d.size,k=new Array(f),l;c=c&&c.length===i*f?c:new Float32Array(i*f),e=e&&e.length===c.length?e:new Float32Array(i*f),c.set(e);for(g=0;g<f;g++)k[g]=d.getChannelData(g);a.process(c,a.channelCount);for(g=0;g<i;g++)for(h=0;h<f;h++)k[h][g]=c[g*a.channelCount+h]}var a=this,b=function(){return this}(),c=null,d=null,e=null;a.start.apply(a,arguments),importScripts(),b.onprocessmedia=f,b.onaudioprocess=g,a._mspBufferFill=f,a._waBufferFill=g},{ready:!1,initMSP:function(a){this.channelCount=a.audioChannels,this.sampleRate=a.audioSampleRate,this.bufferSize=a.audioLength*this.channelCount,this.ready=!0,this.emit("ready",[])},initWA:function(a){var b=a.outputBuffer;this.channelCount=b.numberOfChannels,this.sampleRate=b.sampleRate,this.bufferSize=b.length*this.channelCount,this.ready=!0,this.emit("ready",[])}})}(this.Sink),function(a){(function(){function b(c,d){return c&&d?b[c]=d:c&&b[c]instanceof Function&&(a.interpolate=b[c]),b[c]}a.interpolation=b,b("linear",function(a,b){var c=Math.floor(b),d=c+1,e=b-c;return d=d<a.length?d:0,a[c]*(1-e)+a[d]*e}),b("nearest",function(a,b){return b>=a.length-.5?a[0]:a[Math.round(b)]}),b("linear")})(),a.resample=function(b,c,d,e,f){var g=arguments.length,h=g===2?c:g===3?c/d:e/c*f/d,i=b.length,j=Math.ceil(i/h),k=new Float32Array(j),l,m;for(l=0,m=0;l<i;l+=h)k[m++]=a.interpolate(b,l);return k}}(this.Sink),function(a){a.deinterleave=function(a,b){var c=a.length,d=c/b,e=[],f,g;for(f=0;f<b;f++){e[f]=new Float32Array(d);for(g=0;g<d;g++)e[f][g]=a[g*b+f]}return e},a.interleave=function(a,b,c){b=b||a.length;var d=a[0].length,e=a.length,f,g;c=c||new Float32Array(d*b);for(f=0;f<e;f++)for(g=0;g<d;g++)c[f+g*b]=a[f][g];return c},a.mix=function(a){var b=[].slice.call(arguments,1),c,d,e;for(e=0;e<b.length;e++){c=Math.max(a.length,b[e].length);for(d=0;d<c;d++)a[d]+=b[e][d]}return a},a.resetBuffer=function(a){var b=a.length,c;for(c=0;c<b;c++)a[c]=0;return a},a.clone=function(a,b){var c=a.length,d;b=b||new Float32Array(c);for(d=0;d<c;d++)b[d]=a[d];return b},a.createDeinterleaved=function(a,b){var c=new Array(b),d;for(d=0;d<b;d++)c[d]=new Float32Array(a);return c},a.memcpy=function(a,b,c,d,e){a=a.subarray||a.slice?a:a.buffer,c=c.subarray||c.slice?c:c.buffer,a=b?a.subarray?a.subarray(b,e&&b+e):a.slice(b,e&&b+e):a;if(c.set)c.set(a,d);else for(var f=0;f<a.length;f++)c[f+d]=a[f];return c},a.memslice=function(a,b,c){return a.subarray?a.subarray(b,c):a.slice(b,c)},a.mempad=function(b,c,d){return c=c.length?c:new b.constructor(c),a.memcpy(b,0,c,d),c},a.linspace=function(a,b,c){var d,e,f,g;c=c.length?(d=c.length)&&c:Array(d=c),g=(b-a)/--d;for(f=a+g,e=1;e<d;e++,f+=g)c[e]=f;return c[0]=a,c[d]=b,c},a.ftoi=function(a,b,c){var d,e=Math.pow(2,b-1);c=c||new a.constructor(a.length);for(d=0;d<a.length;d++)c[d]=~~(e*a[d]);return c}}(this.Sink),function(a){function b(b,c){a.EventEmitter.call(this),this.bufferSize=isNaN(b)||b===null?this.bufferSize:b,this.channelCount=isNaN(c)||c===null?this.channelCount:c;var d=this;this.callback=function(){return d.process.apply(d,arguments)},this.resetBuffer()}b.prototype={buffer:null,zeroBuffer:null,parentSink:null,bufferSize:4096,channelCount:2,offset:null,resetBuffer:function(){this.buffer=new Float32Array(this.bufferSize),this.zeroBuffer=new Float32Array(this.bufferSize)},process:function(a,b){this.offset===null&&this.loadBuffer();for(var c=0;c<a.length;c++)this.offset>=this.buffer.length&&this.loadBuffer(),a[c]=this.buffer[this.offset++]},loadBuffer:function(){this.offset=0,a.memcpy(this.zeroBuffer,0,this.buffer,0),this.emit("audioprocess",[this.buffer,this.channelCount])}},a.Proxy=b,a.prototype.createProxy=function(b){var c=new a.Proxy(b,this.channelCount);return c.parentSink=this,this.on("audioprocess",c.callback),c}}(this.Sink),function(a){function b(){this.ringBuffer&&(this.channelMode==="interleaved"?this.ringSpin:this.ringSpinInterleaved).apply(this,arguments)}a.on("init",function(a){a.on("preprocess",b)}),a.prototype.ringBuffer=null,a.prototype.ringSpin=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=this.ringOffset,f;for(f=0;f<c;f++)a[f]+=b[e],e=(e+1)%d;this.ringOffset=e},a.prototype.ringSpinDeinterleaved=function(a){var b=this.ringBuffer,c=a.length,d=b.length,e=b[0].length,f=d*e,g=this.ringOffset,h,i;for(h=0;h<c;h+=d){for(i=0;i<d;i++)a[h+i]+=b[i][g];g=(g+1)%e}this.ringOffset=i}}(this.Sink),function(a,b){b=a.prototype,a.on("init",function(a){a.asyncBuffers=[],a.syncBuffers=[],a.on("preprocess",a.writeBuffersSync),a.on("postprocess",a.writeBuffersAsync)}),b.writeMode="async",b.asyncBuffers=b.syncBuffers=null,b.writeBuffersAsync=function(a){var b=this.asyncBuffers,c=a.length,d,e,f,g,h;if(b)for(f=0;f<b.length;f++){d=b[f],e=d.b.length,h=d.d,d.d-=Math.min(h,c);for(g=0;g+h<c&&g<e;g++)a[g+h]+=d.b[g];d.b=d.b.subarray(g+h),f>=e&&b.splice(f--,1)}},b.writeBuffersSync=function(a){var b=this.syncBuffers,c=a.length,d=0,e=0;for(;d<c&&b.length;d++){a[d]+=b[0][e];if(b[0].length<=e){b.splice(0,1),e=0;continue}e++}b.length&&(b[0]=b[0].subarray(e))},b.writeBufferAsync=function(b,c){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var d=this.asyncBuffers;return d.push({b:b,d:isNaN(c)?~~((+(new Date)-this.previousHit)/1e3*this.sampleRate):c}),d.length},b.writeBufferSync=function(b){b=this.mode==="deinterleaved"?a.interleave(b,this.channelCount):b;var c=this.syncBuffers;return c.push(b),c.length},b.writeBuffer=function(){return this[this.writeMode==="async"?"writeBufferAsync":"writeBufferSync"].apply(this,arguments)},b.getSyncWriteOffset=function(){var a=this.syncBuffers,b=0,c;for(c=0;c<a.length;c++)b+=a[c].length;return b}}(this.Sink),function(a){function b(a){this.boundTo=a,this.buffers=[],a.activeRecordings.push(this)}a.on("init",function(a){a.activeRecordings=[],a.on("postprocess",a.recordData)}),a.prototype.activeRecordings=null,a.prototype.record=function(){var b=new a.Recording(this);return this.emit("record",[b]),b},a.prototype.recordData=function(a){var b=this.activeRecordings,c,d=b.length;for(c=0;c<d;c++)b[c].add(a)},b.prototype={add:function(a){this.buffers.push(a)},clear:function(){this.buffers=[]},stop:function(){var a=this.boundTo.activeRecordings,b;for(b=0;b<a.length;b++)a[b]===this&&a.splice(b--,1)},join:function(){var a=0,b=0,c=this.buffers,d,e,f,g=c.length;for(f=0;f<g;f++)a+=c[f].length;d=new Float32Array(a);for(f=0;f<g;f++){for(e=0;e<c[f].length;e++)d[b+e]=c[f][e];b+=c[f].length}return d}},a.Recording=b}(this.Sink);